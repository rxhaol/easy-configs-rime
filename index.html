<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>颜色展示</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			padding: 20px;
		}

		.input-method {
			border: 1px solid #ccc;
			padding: 10px;
			margin-bottom: 20px;
			display: flex;
			gap: 10px;
			align-items: center;
		}

		.candidate-word {
			padding: 5px;
			display: inline-flex;
			align-items: center;
			font-weight: bold;
		}

		.candidate-label {
			margin-right: 5px;
			display: flex;
			align-items: center;
		}

		.candidate-text {
			display: flex;
			align-items: center;
		}

		.selected-candidate {
			padding: 5px;
			display: inline-flex;
			align-items: center;
			border-radius: 5px;
		}

		.search-container {
			margin-bottom: 20px;
			display: flex;
			align-items: center;
			gap: 10px;
		}

		input[type="text"] {
			padding: 8px;
			font-size: 16px;
			border: 1px solid #ccc;
			border-radius: 4px;
			flex-grow: 1;
		}

		button {
			padding: 8px 16px;
			border: none;
			background-color: #f0f0f0;
			cursor: pointer;
			border-radius: 4px;
		}

		.color-container {
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
		}

		.color-block {
			width: calc(20% - 10px);
			min-width: 120px;
			display: flex;
			flex-direction: column;
			align-items: center;
			border-radius: 8px;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		}

		.color-name {
			color: white;
			text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
			margin-bottom: 5px;
		}

		.color-actions {
			display: flex;
			gap: 5px;
			margin-top: 5px;
		}

		.pagination {
			margin-top: 20px;
			display: flex;
			justify-content: center;
			gap: 10px;
		}

		.pagination button {
			padding: 8px 16px;
			border: none;
			background-color: #f0f0f0;
			cursor: pointer;
			border-radius: 4px;
		}

		.pagination button.active {
			background-color: #007BFF;
			color: white;
		}

		#show-selected-colors {
			margin-left: auto;
		}

		#selected-colors-list {
			display: none;
			border: 1px solid #ccc;
			padding: 10px;
			margin-top: 10px;
			max-height: 200px;
			overflow-y: auto;
		}

		.selected-color-item {
			display: flex;
			align-items: center;
			margin-bottom: 5px;
		}

		.selected-color-preview {
			width: 20px;
			height: 20px;
			border-radius: 4px;
			margin-right: 5px;
		}

		.delete-color-button {
			margin-left: auto;
			padding: 4px 8px;
		}

		#generate-config-button {
			display: none;
			margin-top: 10px;
		}

		#clear-all-colors-button {
			display: none;
			margin-top: 10px;
			margin-right: 10px;
			/* 与生成配置文件按钮保持一定间距 */
		}
	</style>
</head>

<body>
	<div class="input-method" id="input-method">
		<span class="candidate-word selected-candidate">
			<span class="candidate-label">1.</span>
			<span class="candidate-text">候选字1</span>
		</span>
		<span class="candidate-word">
			<span class="candidate-label">2.</span>
			<span class="candidate-text">候选字2</span>
		</span>
		<span class="candidate-word">
			<span class="candidate-label">3.</span>
			<span class="candidate-text">候选字3</span>
		</span>
		<button id="show-selected-colors">显示已添加颜色</button>
	</div>
	<div id="selected-colors-list"></div>
	<button id="clear-all-colors-button" style="display: none;">一键清空</button>
	<button id="generate-config-button">生成配置文件</button>
	<div class="search-container">
		<input type="text" id="search-input" placeholder="搜索颜色名称">
		<button id="clear-button">清空</button>
	</div>
	<div class="color-container" id="color-container"></div>
	<div class="pagination" id="pagination"></div>

	<script>
		const colorContainer = document.getElementById('color-container');
		const searchInput = document.getElementById('search-input');
		const clearButton = document.getElementById('clear-button');
		const paginationContainer = document.getElementById('pagination');
		const inputMethod = document.getElementById('input-method');
		const showSelectedColorsButton = document.getElementById('show-selected-colors');
		const selectedColorsList = document.getElementById('selected-colors-list');
		let allColors = [];
		let currentPage = 1;
		const itemsPerPage = 30;

		// 使用 fetch API 读取本地 JSON 文件
		fetch('colors.json')
			.then(response => {
				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}
				return response.json();
			})
			.then(colors => {
				allColors = colors;
				renderPage(colors);
			})
			.catch(error => {
				console.error('读取 JSON 文件时出错: ', error);
			});

		// 渲染指定页面的颜色块
		function renderPage(colors) {
			const startIndex = (currentPage - 1) * itemsPerPage;
			const endIndex = startIndex + itemsPerPage;
			const currentPageColors = colors.slice(startIndex, endIndex);

			renderColors(currentPageColors);
			renderPagination(colors);
		}

		// 渲染颜色块的函数
		function renderColors(colors) {
			colorContainer.innerHTML = '';
			colors.forEach(color => {
				const colorBlock = document.createElement('div');
				colorBlock.classList.add('color-block');

				const colorDisplay = document.createElement('div');
				colorDisplay.style.backgroundColor = color.hex;
				colorDisplay.style.width = '100%';
				colorDisplay.style.height = '60px';
				colorDisplay.style.display = 'flex';
				colorDisplay.style.flexDirection = 'column';
				colorDisplay.style.alignItems = 'center';
				colorDisplay.style.justifyContent = 'center';

				const colorName = document.createElement('div');
				colorName.classList.add('color-name');
				colorName.textContent = color.name;

				colorDisplay.appendChild(colorName);
				colorBlock.appendChild(colorDisplay);

				const colorActions = document.createElement('div');
				colorActions.classList.add('color-actions');

				const previewButton = document.createElement('button');
				previewButton.textContent = '预览';
				previewButton.addEventListener('click', () => {
					updateInputMethodColors(color.hex);
				});

				const addButton = document.createElement('button');
				addButton.textContent = '添加';
				addButton.addEventListener('click', () => {
					addColorToLocalStorage(color);
				});

				colorActions.appendChild(previewButton);
				colorActions.appendChild(addButton);
				colorBlock.appendChild(colorActions);

				colorContainer.appendChild(colorBlock);
			});
		}

		// 渲染分页按钮
		function renderPagination(colors) {
			const totalPages = Math.ceil(colors.length / itemsPerPage);
			paginationContainer.innerHTML = '';

			for (let i = 1; i <= totalPages; i++) {
				const button = document.createElement('button');
				button.textContent = i;
				if (i === currentPage) {
					button.classList.add('active');
				}
				button.addEventListener('click', () => {
					currentPage = i;
					renderPage(colors);
				});
				paginationContainer.appendChild(button);
			}
		}

		// 更新输入法颜色
		function updateInputMethodColors(hexColor) {
			const alphaHex = '32';
			const selectedBgColor = hexColor + alphaHex;

			inputMethod.style.backgroundColor = '#FFFFFF';
			const candidateLabels = document.querySelectorAll('.candidate-label');
			candidateLabels.forEach(label => {
				label.style.color = '#8E8E8E';
			});
			const candidateTexts = document.querySelectorAll('.candidate-text');
			candidateTexts.forEach(text => {
				text.style.color = '#454545';
			});
			const selectedCandidate = document.querySelector('.selected-candidate');
			const selectedCandidateLabel = selectedCandidate.querySelector('.candidate-label');
			const selectedCandidateText = selectedCandidate.querySelector('.candidate-text');
			selectedCandidate.style.backgroundColor = selectedBgColor;
			selectedCandidateLabel.style.color = hexColor;
			selectedCandidateText.style.color = hexColor;
		}

		// 搜索功能
		searchInput.addEventListener('input', function () {
			const searchTerm = this.value.toLowerCase();
			const filteredColors = allColors.filter(color => {
				return color.name.toLowerCase().includes(searchTerm);
			});
			currentPage = 1;
			renderPage(filteredColors);
		});

		// 清空按钮点击事件
		clearButton.addEventListener('click', function () {
			searchInput.value = '';
			currentPage = 1;
			renderPage(allColors);
		});

		// 增加对生成配置文件按钮的引用
		const generateConfigButton = document.getElementById('generate-config-button');
		// 记录已添加颜色列表的显示状态
		let isColorListVisible = false;

		const clearAllColorsButton = document.getElementById('clear-all-colors-button');

		// 修改显示已添加颜色按钮的点击事件
		showSelectedColorsButton.addEventListener('click', () => {
			const storedColors = JSON.parse(localStorage.getItem('selectedColors')) || [];
			if (isColorListVisible) {
				// 如果列表是显示的，点击后关闭列表和相关按钮
				selectedColorsList.style.display = 'none';
				generateConfigButton.style.display = 'none';
				clearAllColorsButton.style.display = 'none';
				isColorListVisible = false;
			} else {
				selectedColorsList.innerHTML = '';
				if (storedColors.length === 0) {
					selectedColorsList.textContent = '暂无已添加颜色。';
					generateConfigButton.style.display = 'none';
					clearAllColorsButton.style.display = 'none';
				} else {
					storedColors.forEach(color => {
						const colorItem = document.createElement('div');
						colorItem.classList.add('selected-color-item');

						const colorPreview = document.createElement('div');
						colorPreview.classList.add('selected-color-preview');
						colorPreview.style.backgroundColor = color.hex;

						const colorName = document.createElement('span');
						colorName.textContent = color.name;

						const deleteButton = document.createElement('button');
						deleteButton.textContent = '删除';
						deleteButton.classList.add('delete-color-button');
						deleteButton.addEventListener('click', () => {
							deleteColorFromLocalStorage(color);
						});

						colorItem.appendChild(colorPreview);
						colorItem.appendChild(colorName);
						colorItem.appendChild(deleteButton);
						selectedColorsList.appendChild(colorItem);
					});
					generateConfigButton.style.display = 'inline-block';
					clearAllColorsButton.style.display = 'inline-block';
				}
				selectedColorsList.style.display = 'block';
				isColorListVisible = true;
			}
		});

		clearAllColorsButton.addEventListener('click', () => {
			localStorage.removeItem('selectedColors');
			renderSelectedColorsList();
		});

		// 重新渲染已选择颜色的列表

		function renderSelectedColorsList() {
			selectedColorsList.innerHTML = '';
			const storedColors = JSON.parse(localStorage.getItem('selectedColors')) || [];
			if (storedColors.length === 0) {
				selectedColorsList.textContent = '暂无已添加颜色。';
				generateConfigButton.style.display = 'none';
				clearAllColorsButton.style.display = 'none';
				// 若没有颜色了，关闭显示窗口
				if (isColorListVisible) {
					selectedColorsList.style.display = 'none';
					isColorListVisible = false;
				}
			} else {
				storedColors.forEach(color => {
					const colorItem = document.createElement('div');
					colorItem.classList.add('selected-color-item');

					const colorPreview = document.createElement('div');
					colorPreview.classList.add('selected-color-preview');
					colorPreview.style.backgroundColor = color.hex;

					const colorName = document.createElement('span');
					colorName.textContent = color.name;

					const deleteButton = document.createElement('button');
					deleteButton.textContent = '删除';
					deleteButton.classList.add('delete-color-button');
					deleteButton.addEventListener('click', () => {
						deleteColorFromLocalStorage(color);
					});

					colorItem.appendChild(colorPreview);
					colorItem.appendChild(colorName);
					colorItem.appendChild(deleteButton);
					selectedColorsList.appendChild(colorItem);
				});
				generateConfigButton.style.display = 'inline-block';
				clearAllColorsButton.style.display = 'inline-block';
				if (isColorListVisible) {
					selectedColorsList.style.display = 'block';
				}
			}
		}

		// 从 localStorage 中删除颜色
		function deleteColorFromLocalStorage(color) {
			let storedColors = JSON.parse(localStorage.getItem('selectedColors')) || [];
			storedColors = storedColors.filter(storedColor => storedColor.hex !== color.hex);
			localStorage.setItem('selectedColors', JSON.stringify(storedColors));
			// 删除颜色后重新渲染列表
			renderSelectedColorsList();
		}

		// 将颜色添加到 localStorage
		function addColorToLocalStorage(color) {
			let storedColors = JSON.parse(localStorage.getItem('selectedColors')) || [];
			const isColorExists = storedColors.some(storedColor => storedColor.hex === color.hex);
			if (!isColorExists) {
				storedColors.push(color);
				localStorage.setItem('selectedColors', JSON.stringify(storedColors));
				// 如果显示已添加颜色的窗口是关闭的，打开并渲染列表
				if (!isColorListVisible) {
					isColorListVisible = true;
					renderSelectedColorsList();
					selectedColorsList.style.display = 'block';
					generateConfigButton.style.display = 'inline-block';
				} else {
					// 如果窗口是打开的，直接渲染列表
					renderSelectedColorsList();
				}
			}
		}
		// 为生成配置文件按钮添加点击事件
		generateConfigButton.addEventListener('click', () => {
			const storedColors = JSON.parse(localStorage.getItem('selectedColors'));
			const alphaHex = '26';
			let yamlContent = `customization:
  distribution_code_name: Weasel
  distribution_version: 0.16.3
  generator: "Weasel::UIStyleSettings"
  modified_time: "Mon Jan 27 22:39:43 2025"
  rime_version: 1.11.2
patch:
  preset_color_schemes:`;

			storedColors.forEach(color => {
				const hexColor = color.hex.replace('#', '0x');
				const selectedBgColor = hexColor + alphaHex;
				yamlContent += `
    ${color.pinyin}: {author: rxhaol, back_color: 0xFFFFFF, border_color: 0xFFFFFF, candidate_text_color: 0x454545, color_format: rgba, hilited_candidate_back_color: ${selectedBgColor}, hilited_candidate_text_color: ${hexColor}, hilited_label_color: ${hexColor}, label_color: 0x8E8E8E, name: "${color.name}"}`;
			});

			yamlContent += `
  style:
    blur: true
    font_face: "TsangerJinKai05 W04,LXGW WenKai Mono"
    font_point: 14
    horizontal: true
    inline_preedit: true
    label_font_point: 12
    layout: {border: 2, candidate_spacing: 14, hilite_padding: 4, hilite_spacing: 2, margin_x: 6, margin_y: 6, round_corner: 5, spacing: 5}`;

			const blob = new Blob([yamlContent], { type: 'text/yaml' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = 'weasel.custom.yaml';
			a.click();
			URL.revokeObjectURL(url);
		});

	</script>
</body>

</html>